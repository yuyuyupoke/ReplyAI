{% extends "base.html" %}

{% block content %}
<div class="header">
    <a href="{{ url_for('videos') }}" class="back-link">â† HOME</a>
    <h1>è¿”ä¿¡ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</h1>
</div>

<div class="template-create">
    <h2>æ–°è¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆ</h2>
    <input type="text" id="template-name" placeholder="ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåï¼ˆä¾‹ï¼šãŠç¤¼ï¼‰" maxlength="50">
    <textarea id="template-text" placeholder="è¿”ä¿¡æ–‡ï¼ˆä¾‹ï¼šã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ğŸ˜Šï¼‰" maxlength="500"></textarea>
    <button onclick="saveTemplate()" class="btn-primary">ä¿å­˜</button>
</div>

<div class="template-list">
    <h2>ä¿å­˜æ¸ˆã¿ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</h2>
    {% if templates %}
        {% for template in templates %}
        <div class="template-card" data-id="{{ template.id }}">
            <h3>{{ template.name }}</h3>
            <p>{{ template.text }}</p>
            <button onclick="deleteTemplate('{{ template.id }}')" class="btn-delete">å‰Šé™¤</button>
        </div>
        {% endfor %}
    {% else %}
        <p class="no-templates">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒã‚ã‚Šã¾ã›ã‚“ã€‚ä¸Šè¨˜ã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ä½œæˆã—ã¦ãã ã•ã„ã€‚</p>
    {% endif %}
</div>

<script>
async function saveTemplate() {
    const name = document.getElementById('template-name').value.trim();
    const text = document.getElementById('template-text').value.trim();

    if (!name || !text) {
        alert('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåã¨è¿”ä¿¡æ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
    }

    const response = await fetch('/api/templates', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({name, text})
    });

    if (response.ok) {
        location.reload();
    } else {
        alert('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
}

async function deleteTemplate(id) {
    if (!confirm('ã“ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;

    const response = await fetch(`/api/templates/${id}`, {method: 'DELETE'});
    if (response.ok) {
        location.reload();
    } else {
        alert('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
}
</script>
{% endblock %}
