<div class="comment-card {% if comment.is_manually_completed %}pending-comment-card{% elif comment.is_replied %}replied-comment-card{% endif %}"
    id="comment-{{ comment.id }}">
    <div class="comment-header">
        <div class="comment-meta-left">
            <input type="checkbox" class="comment-checkbox" data-comment-id="{{ comment.id }}" data-video-id="{{ video_id }}" data-comment-text="{{ comment.text | replace('`', '\`') }}">
            <img src="{{ comment.author_image }}" alt="{{ comment.author_name }}" class="author-img">
            <span class="author-name">@{{ comment.author_name }}</span>
            <span class="date">
                {{ comment.published_at[:10] }}
                {% if comment.is_edited %}
                <span title="ç·¨é›†æ¸ˆã¿ ({{ comment.updated_at[:10] }})">âœï¸</span>
                {% endif %}
            </span>
        </div>
        <div class="comment-meta-right" id="meta-{{ comment.id }}" data-rating="{{ comment.viewer_rating }}">
            <span class="like-count">ğŸ‘ {{ comment.like_count }}</span>
            <!-- Like count restored -->

            <!-- Like/Dislike buttons removed due to API limitations -->

            {% if not comment.is_replied and not comment.is_manually_completed %}
            <button class="btn-icon" onclick="markComplete('{{ comment.id }}')" title="æ—¢èª­ã«ã™ã‚‹ï¼ˆä¿ç•™ï¼‰">
                <span class="icon-emoji">âœ…</span>
            </button>
            {% endif %}

            {% if comment.is_manually_completed %}
            <button class="btn-icon" onclick="unmarkComplete('{{ comment.id }}')" title="æ—¢èª­ã‚’å–ã‚Šæ¶ˆã™">
                <span class="icon-emoji">â†©ï¸</span>
            </button>
            {% endif %}

            <button class="btn-icon" onclick="deleteComment('{{ comment.id }}')" title="å‰Šé™¤">
                <span class="icon-emoji">ğŸ—‘ï¸</span>
            </button>
        </div>
    </div>
    <div class="comment-text">{{ comment.text }}</div>

    {% if comment.is_replied and comment.replies %}
    <!-- Reply Thread -->
    <div class="reply-thread" id="thread-{{ comment.id }}">
        {% for reply in comment.replies %}
        <div class="reply-item {% if reply.is_mine %}my-reply{% endif %}" id="comment-{{ reply.id }}">
            <img src="{{ reply.author_image }}" alt="{{ reply.author_name }}" class="reply-author-img">
            <div class="reply-content">
                <div class="reply-header">
                    <span class="reply-author-name">@{{ reply.author_name }}</span>
                    <span class="reply-date">{{ reply.published_at[:10] }}</span>
                    {% if reply.is_mine %}
                    <button class="btn-icon-small" onclick="deleteComment('{{ reply.id }}')" title="å‰Šé™¤">ğŸ—‘ï¸</button>
                    {% endif %}
                </div>
                <div class="reply-text">{{ reply.text }}</div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="reply-section">


        <!-- Generate Button -->
        <div class="generate-btn-wrapper">
            <button class="btn-generate"
                onclick="generateReply('{{ comment.id }}', '{{ video_id }}', `{{ comment.text | replace('`', '\`') }}`)"
                id="btn-generate-{{ comment.id }}">âœ¨ è¿”ä¿¡æ¡ˆã‚’ç”Ÿæˆ</button>
            <button class="btn-regenerate"
                onclick="generateReply('{{ comment.id }}', '{{ video_id }}', `{{ comment.text | replace('`', '\`') }}`)"
                id="btn-regenerate-{{ comment.id }}" style="display: none;">ğŸ”„ å†ç”Ÿæˆ</button>
        </div>

        <!-- Suggestions Chips -->
        <div id="suggestions-{{ comment.id }}" class="suggestions-box" style="display: none;"></div>

        <!-- Template Selector -->
        <div class="template-selector">
            <button onclick="toggleTemplates('{{ comment.id }}')" class="btn-template">ğŸ“ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</button>
            <div id="templates-{{ comment.id }}" class="template-dropdown" style="display: none;"></div>
        </div>

        <!-- Manual Reply Area (Always Visible) -->
        <div class="reply-input-wrapper">
            <textarea id="reply-text-{{ comment.id }}" class="reply-input" placeholder="è¿”ä¿¡ã‚’å…¥åŠ›..."></textarea>

            <!-- Hidden fields to store context for logging -->
            <input type="hidden" id="original-comment-{{ comment.id }}" value="{{ comment.text }}">
            <input type="hidden" id="ai-suggestion-{{ comment.id }}" value="">

            <button id="btn-post-{{ comment.id }}" class="btn-post"
                onclick="postReply('{{ comment.id }}', {{ 'true' if comment.is_replied else 'false' }}, '{{ video_id }}')">è¿”ä¿¡</button>
        </div>
    </div>
</div>