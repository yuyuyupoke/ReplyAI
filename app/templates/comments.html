{% extends "base.html" %}

{% block content %}
<div class="sticky-header-container">
    <div class="header">
        <a href="{{ url_for('videos') }}" class="back-link">← HOME</a>
        <div class="header-video-info">
            {% if video %}
            <img src="{{ video.thumbnail }}" alt="{{ video.title }}" class="header-video-thumb">
            <div>
                <h2 class="header-video-title">{{ video.title }}</h2>
                <a href="https://www.youtube.com/watch?v={{ video_id }}" target="_blank"
                    class="youtube-link">YouTubeで見る</a>
            </div>
            {% else %}
            <h1>コメント返信</h1>
            {% endif %}
        </div>
        <div class="stats-widget">
            <div class="stat-item unreplied">
                <span class="stat-label">未返信</span>
                <span class="stat-count">{{ reply_stats.unreplied }}</span>
            </div>
            <div class="stat-item pending">
                <span class="stat-label">保留</span>
                <span class="stat-count">{{ reply_stats.pending }}</span>
            </div>
            <div class="stat-item replied">
                <span class="stat-label">返信済み</span>
                <span class="stat-count">{{ reply_stats.replied }}</span>
            </div>
        </div>
    </div>

    <div class="controls">
        <div class="filter-tabs">
            <a href="{{ url_for('comments', video_id=video_id, sort=current_sort, filter='unreplied') }}"
               class="tab-btn {% if current_filter=='unreplied' %}active{% endif %}">
                未返信 <span class="tab-count">({{ reply_stats.unreplied }})</span>
            </a>
            <a href="{{ url_for('comments', video_id=video_id, sort=current_sort, filter='pending') }}"
               class="tab-btn {% if current_filter=='pending' %}active{% endif %}">
                保留 <span class="tab-count">({{ reply_stats.pending }})</span>
            </a>
            <a href="{{ url_for('comments', video_id=video_id, sort=current_sort, filter='replied') }}"
               class="tab-btn {% if current_filter=='replied' %}active{% endif %}">
                返信済み <span class="tab-count">({{ reply_stats.replied }})</span>
            </a>
        </div>

        <label for="sort-select">並び替え：</label>
        <select id="sort-select" onchange="location = this.value;">
            <option value="{{ url_for('comments', video_id=video_id, sort='date_desc', filter=current_filter) }}" {% if
                current_sort=='date_desc' %}selected{% endif %}>投稿日 (新しい順)</option>
            <option value="{{ url_for('comments', video_id=video_id, sort='date_asc', filter=current_filter) }}" {% if current_sort=='date_asc'
                %}selected{% endif %}>投稿日 (古い順)</option>
            <option value="{{ url_for('comments', video_id=video_id, sort='likes_desc', filter=current_filter) }}" {% if
                current_sort=='likes_desc' %}selected{% endif %}>いいね数</option>
        </select>
    </div>

    <!-- Bulk Actions Bar -->
    <div class="bulk-actions-bar" style="display: none;" id="bulk-bar">
        <span id="bulk-count">0件選択中</span>
        <button onclick="bulkGenerate()" class="btn-bulk">一括返信生成</button>
        <button onclick="bulkMarkComplete()" class="btn-bulk">一括保留</button>
        <button onclick="clearSelection()" class="btn-bulk-cancel">選択解除</button>
    </div>
</div>

<div class="comments-section">
    <div class="comments-list" id="comments-list">
        {% if not comments %}
        <p class="no-comments">コメントはありません。</p>
        {% endif %}

        {% for comment in comments %}
        {% include 'comment_card_v2.html' %}
        {% endfor %}
    </div>
</div>


{% endblock %}